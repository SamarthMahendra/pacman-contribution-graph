<!doctype html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>GitLab Contributions Pac-Man</title>
		<style>
			body {
				text-align: center;
				margin: 0 0 70px;
				padding: 0;
			}
			canvas {
				border: 1px solid #000;
			}
			.page-statistics {
				padding: 30px;
				position: fixed;
				bottom: 0;
				width: 100%;
			}
		</style>
	</head>
	<body>
		<h1>GitLab Contributions Pac-Man</h1>

		<canvas id="canvas"></canvas>
		<br />

		<label for="platform">Choose Platform:</label>
		<select id="platform">
			<option value="github">GitHub</option>
			<option value="gitlab">GitLab</option>
		</select>
		<select id="output">
			<option value="canvas">Canvas</option>
			<option value="svg">svg</option>
		</select>
		<input type="text" id="username" placeholder="Enter Username" />
		<button id="generate">Generate</button>
		<div>
			<img id="svgholder" />
		</div>

		<div class="page-statistics">
			<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
			<span id="busuanzi_container_site_pv"> Total visits to the site <span id="busuanzi_value_site_pv"></span> times</span>
			<span class="post-meta-divider">|</span>
			<span id="busuanzi_container_site_uv">Number of visitors <span id="busuanzi_value_site_uv"></span> people</span>
		</div>

		<script type="module">
			import { renderContributions } from './dist/pacman-contribution-graph.js';

			const generateButton = document.getElementById('generate');
			generateButton.addEventListener('click', async () => {
				const canvas = document.getElementById('canvas');
				const usernameInput = document.getElementById('username');
				const platformSelect = document.getElementById('platform');
				const outputSelect = document.getElementById('output');
				const svgHolder = document.getElementById('svgholder');
				const username = usernameInput.value;
				if (!username) return;

				outputSelect.disabled = true;

				if (outputSelect.value == 'canvas') {
					const initializeGameCanvas = () =>
						renderContributions({
							platform: platformSelect.value,
							username: usernameInput.value,
							canvas: canvas,
							outputFormat: 'canvas',
							gameOverCallback: () => {
								console.log('GAME OVER');
								setTimeout(() => {
									console.log('Restarting');
									initializeGameCanvas();
								}, 3000);
							},
							gameTheme: 'github'
						});
					initializeGameCanvas();
				} else {
					const initializeGameSvg = () =>
						renderContributions({
							platform: platformSelect.value,
							username: usernameInput.value,
							outputFormat: 'svg',
							svgCallback: (blobUrl) => {
								svgHolder.src = blobUrl;
							},
							gameOverCallback: () => {
								console.error('GAME OVER');
							},
							gameTheme: 'github-dark'
						});
					initializeGameSvg();
				}
			});
		</script>
	</body>
</html>
